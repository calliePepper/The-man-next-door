<!DOCTYPE html>
<html> 
    <head> 
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">   
        <title>The Man Next Door</title>
        <link href="css/style.css" rel="stylesheet" type="text/css" />
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" />
        <link href='https://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
    </head>
    <body id="frontPage" class="frontPage">
        <div class="infoBox">
            <h1>The man next door</h1>
            <p>The man next door is an interactive narrative, set on a fictional social media network. There are a couple of things you should know before you start:</p>
            <ol>
                <li>Please be aware this site uses some techniques which <strong class="colouredText">may trigger epileptic attacks</strong></li>
                <li><strong class="colouredText">This narrative runs in real time</strong>. From the moment you hit start the story will unfold at its own pace, not yours</li>
                <li>Occasionally, <strong class="colouredText">the page may play sounds</strong>. These sounds are not controllable, but muting the page will not cause you to miss out on any important information</li>
            </ol>
            <p>If you have understood all of this, please feel free to enter your name below, upload a thumbnail (optional) and then click the start button</p>
            <div class="halfer">
                <label for="name">Your name:</label><br><input type="text" id="name" name="name" />
            </div>
            <div class="halfer">
                <label for="file">Your thumbnail:</label><br><span id="putThumbHere"></span><input type="file" name="file" id="file" />
            </div>  
            <div class="startBlock">
                <div id="startBtn" class="btn startBtn">Click here to start</div>   
            </div>
    	    
        </div>
        <script>
            Storage.prototype.setObject = function(key, value) {
                this.setItem(key, JSON.stringify(value));
            }
            
            Storage.prototype.getObject = function(key) {
                var value = this.getItem(key);
                return value && JSON.parse(value);
            }
            
        </script>
        <script type="text/javascript" src="script/jquery.min.js"></script>
        <script type="text/javascript" src="/socket.io/socket.io.js"></script>
        <script type="text/javascript" src="script/data.js"></script>
        <script type="text/javascript" src="script/moment.js"></script>
        <script type="text/javascript" src="script/glitch.js"></script>
        <script>
            var userAvatar = 'userAvatar.jpg';
        
            if (localStorage.thumb) {
                $('#putThumbHere').html('<img class="thumb" src="'+ localStorage.thumb +'" tile="Old icon"/>');
                userAvatar = localStorage.thumb;
            }
        
        
            function handleFile(evt) {
                var file = evt.target.files;
                
                for (var i = 0, f; f = file[i]; i++) {
                    
                    if (!f.type.match('image.*')) {
                        alert('Please upload an image');
                    } else if (f.size > 1000000) { 
                        alert('Please upload a smaller image (max 1mb)');
                    } else {
                        var reader = new FileReader();
                        
                        reader.onload = (function(theFile) {
                            return function(e) {
                                $('#putThumbHere').html('<img class="thumb" src="'+ e.target.result +'" tile="'+ escape(theFile.name) + '"/>');
                                localStorage.setItem('thumb',e.target.result);
                                userAvatar = e.target.result;
                            }
                        })(f);
                        
                        reader.readAsDataURL(f);
                    }
                }
            }
    
            document.getElementById('file').addEventListener('change',handleFile, false);
            
            $('#startBtn').on('click touch', function() {
                if ($('#name').val() != '') {
                    if (typeof(Storage) !== 'undefined') {
                        var gameData = {
                            name:$('#name').val(),
                            startTime:moment().format(),
                            lastUpdate:moment().format(),
                            timezone:new Date().getTimezoneOffset(),
                            lastMessage: {
                                1:0,
                                2:0
                            },
                            lastFeed: 0,
                            firstLoad: 1,
                            unread: {
                                'posts':0,
                                'messages':0
                            }
                        };
                        localStorage.setObject('gameSettings',gameData);
                        var comments = {
                                1: [
                                    new comment(1,1,1444611193,'God I am awesome','','',-2),
                                    new comment(1,1,1444610193,'So amazingly awesome','','',5),
                                ]
                        }
                        
                        var choices = {
                            3: new choice(3,'Deal with the problem yourself','Ignore it, it will go away','Skin the cat. It\'s the only solution. Skin. The. Cat')
                        }
            
                        var totalData = {
                            posts: [
                                new post(1,1,1444511193,'Check out this image, found it at <a href="http://image.google.com">Google</a>','exampleLink.jpg','',500,comments[1],choices[3],0,0),
                                new post(2,1,1444362078,'Yo yo yo','','',23,'','',0,0),
                                new post(3,1,1444162078,'Bitches love me','','',7,'','',0,0)
                            ],
                            trending: [
                                new trending(1,'Twaddle','A new social media for the masses, is looking for new employees'),
                                new trending(1,'Puppy love','A puppy is a small regional zoo has made friends with a zebra, and they are the most unlikeliest of companions!'),
                                new trending(1,'Baby Possom','Photos shared of baby marsupial snuggling with toy kangaroo'),
                                new trending(1,'Skinning Cats','There are more than one way! Our top chefs look at old age techniques that you probably have never heard of'),
                                new trending(1,'Netherworld vacation','Are you tired of your boring existance? Think you deserve a great vacation? We show you paths that the guides don\'t want you to know about')
                            ],
                            messages: [
                                new message(1,1,1444734245,'Hey, thanks for the friend request','','',1,'0_1'),
                                new message(2,2,1444734245,'Hey, you\'re that friend that Sam keeps talking about right?','','',1,'0_2')
                            ],
                            users: {
                                0: new user($('#name').val(),'','they',1412314,userAvatar,'',0,0,0),
                                1: new user('Sam','Creed','they',1429323,'img/samAvatar.png','samBg.jpg',1,160,1300,0,0),
                                2: new user('Cal','Ransom','she',1423413,'img/calAvatar.jpg','calBg.jpg',0,120,1500,0,0)
                            }
                        };          
                        
                        
                        localStorage.setObject('gameData',totalData);
                        window.location.href = "twaddle";
                    } else {
                        alert('Sorry your device does not support the required technology (HTML5 Local storage)');
                    }
                } else {
                    $('#name').addClass('badInput');
                }
            });
            
            function testSound() {
               var audio = new Audio("sounds/roar.wav");
                audio.play();
                setTimeout(testSound(),400);
            }
            
            //testSound();
        </script>
    </body>	
</html>